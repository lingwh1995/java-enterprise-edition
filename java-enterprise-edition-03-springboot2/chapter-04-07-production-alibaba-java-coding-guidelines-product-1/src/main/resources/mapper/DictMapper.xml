<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.bluebridge.mapper.DictMapper">

    <!-- Dict实体的ResultMap，用于映射嵌套的dictDataList -->
    <resultMap id="dictResultMap" type="dictDO">
        <id column="id" property="id" />
        <result column="dict_code" property="dictCode" />
        <result column="dict_name" property="dictName" />
        <result column="dict_type" property="dictType" />
        <result column="dict_status" property="dictStatus" />
        <result column="dict_desc" property="dictDesc" />
        <result column="sort_order" property="sortOrder" />
        <result column="create_user" property="createUser" />
        <result column="create_time" property="createTime" typeHandler="org.bluebridge.common.typehandler.LocalDateTimeTypeHandler"/>
        <result column="update_user" property="updateUser" />
        <result column="update_time" property="updateTime" typeHandler="org.bluebridge.common.typehandler.LocalDateTimeTypeHandler"/>

        <!-- 嵌套映射dictDataList -->
        <collection property="dictDataList" ofType="dictDataDO">
            <id column="dd_id" property="id" />
            <result column="dd_dict_code" property="dictCode" />
            <result column="dict_label" property="dictLabel" />
            <result column="dict_value" property="dictValue" />
            <result column="is_default" property="isDefault" />
            <result column="dd_dict_status" property="dictStatus" />
            <result column="dict_data_desc" property="dictDataDesc" />
            <result column="dd_sort_order" property="sortOrder" />
            <result column="dd_create_user" property="createUser" />
            <result column="dd_create_time" property="createTime" typeHandler="org.bluebridge.common.typehandler.LocalDateTimeTypeHandler"/>
            <result column="dd_update_user" property="updateUser" />
            <result column="dd_update_time" property="updateTime" typeHandler="org.bluebridge.common.typehandler.LocalDateTimeTypeHandler"/>
        </collection>
    </resultMap>

    <!-- 根据条件查询字典 -->
    <select id="selectDictListWithJoin" resultMap="dictResultMap">
        SELECT
            d.id,
            d.dict_code,
            d.dict_name,
            d.dict_type,
            d.dict_status,
            d.dict_desc,
            d.sort_order,
            d.create_user,
            d.create_time,
            d.update_user,
            d.update_time,
            dd.id as dd_id,
            dd.dict_code as dd_dict_code,
            dd.dict_label,
            dd.dict_value,
            dd.is_default,
            dd.dict_status as dd_dict_status,
            dd.dict_data_desc,
            dd.sort_order as dd_sort_order,
            dd.create_user as dd_create_user,
            dd.create_time as dd_create_time,
            dd.update_user as dd_update_user,
            dd.update_time as dd_update_time
        from t_sys_dict d
        left join t_sys_dict_data dd on d.dict_code = dd.dict_code and dd.dict_status = 0 and dd.is_deleted = 0
        <where>
            d.is_deleted = 0
            and d.dict_status = 0
            <if test="dict != null and dict_code != null and dict_code != ''">
                and d.dict_code = #{dict_code}
            </if>
        </where>

        <choose>
            <when test="sortList != null and sortList.size() > 0">
                ORDER BY
                <foreach collection="sortList" item="sort" separator=",">
                    ${sort.orderBy} ${sort.order}
                </foreach>
            </when>
            <otherwise>
                ORDER BY d.create_time DESC
            </otherwise>
        </choose>
    </select>

</mapper>
